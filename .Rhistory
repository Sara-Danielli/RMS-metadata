# define column annotation
column_ha = HeatmapAnnotation(df = annotation_info,
col = col_column_ha)
# define row annotation
row_ha = rowAnnotation(Group = genes_df$Group)
# genes to mark
rows_genes_to_mark <- which(genes_df$Values %in% elements_to_find)
rows_genes_to_mark_name <- genes_df$Values[rows_genes_to_mark]
right_ha = rowAnnotation(foo = anno_mark(at = rows_genes_to_mark,
labels = rows_genes_to_mark_name))
# genes to mark
elements_to_find <- c('FN1', 'CAV1', 'PAX7', 'MEOX2', 'CD44',
'MYOD1', 'MYOG', 'MYH3',
'MKI67', 'CENPF',
'TTN', 'MYL4',
'SYP', 'L1CAM', 'CHGA', 'DCX', 'STMN4')
rows_genes_to_mark <- which(genes_df$Values %in% elements_to_find)
rows_genes_to_mark_name <- genes_df$Values[rows_genes_to_mark]
# genes to mark
rows_genes_to_mark <- which(genes_df$Values %in% elements_to_find)
rows_genes_to_mark_name <- genes_df$Values[rows_genes_to_mark]
right_ha = rowAnnotation(foo = anno_mark(at = rows_genes_to_mark,
labels = rows_genes_to_mark_name))
# define colors heatmap
col_fun = colorRamp2(c(-1, 0, 1), c("#2E5A87FF", "#FCFDFEFF", "#A90C38FF"))
# plot heatmap
Cairo::CairoPDF(file.path(plot_dir, "1_P7F1_heatmap_aggregate_50.pdf"), width=6, height=8)
ht <- Heatmap(seurat_df,
cluster_columns = FALSE,
show_row_names = FALSE,
show_column_names = FALSE,
#bottom_annotation = bottom_ha,
border = TRUE,
row_split = factor(c(genes_df$Group),
levels = c('Progenitor', 'Proliferative', 'Ground', 'Differentiated', 'Neuronal', 'Apoptosis')),
top_annotation = column_ha,
right_annotation = right_ha,
use_raster = TRUE,
raster_quality = 10,
cluster_rows = FALSE,
col = col_fun,
row_names_rot = 30
)
draw(ht)
dev.off()
markers <- read.csv(file.path(genelist_dir, 'P7F1_cluster_markers.csv'))
# rename DNA replication as Proliferative
markers <- markers %>%
mutate_all(~ ifelse(. == 'DNA replication', 'Proliferative', .))
# order by Annotation and fold change
markers <- markers %>% arrange(cluster, desc(avg_log2FC))
markers <- as.data.frame(markers)
# convert into list
marker_list <- split(markers[, -c(1:7)], f = markers$cluster)
# Remove duplicates and keep only one occurrence of each element
marker_list <- unique(marker_list)
# select top 10 genes per cluster
marker_list <- lapply(marker_list,head,100)
# Subset seurat object to genes of interest -----------------------------------
# create df with genes of interest
genes <- marker_list
genes_df <- data.frame(
Values = unlist(marker_list),
Group = rep(names(marker_list), sapply(marker_list, length))
)
marker_list
# order by Annotation and fold change
markers <- markers %>% arrange(cluster, desc(avg_log2FC))
markers <- as.data.frame(markers)
# convert into list
marker_list <- split(markers[, -c(1:7)], f = markers$cluster)
marker_list
# load gene lists -----------------------------------
markers <- read.csv(file.path(genelist_dir, 'P7F1_cluster_markers.csv'))
# rename DNA replication as Proliferative
markers <- markers %>%
mutate_all(~ ifelse(. == 'DNA replication', 'Proliferative', .))
# order by Annotation and fold change
markers <- markers %>% arrange(cluster, desc(avg_log2FC))
markers <- as.data.frame(markers)
# convert into list
marker_list <- split(markers[, -c(1:7)], f = markers$cluster)
# Remove duplicates and keep only one occurrence of each element
# Remove duplicates within each vector
marker_list <- lapply(my_list, unique)
# Remove duplicates and keep only one occurrence of each element
# Remove duplicates within each vector
marker_list <- lapply(marker_list, unique)
# select top 10 genes per cluster
marker_list <- lapply(marker_list,head,100)
marker_list
# Subset seurat object to genes of interest -----------------------------------
# create df with genes of interest
genes <- marker_list
genes_df <- data.frame(
Values = unlist(marker_list),
Group = rep(names(marker_list), sapply(marker_list, length))
)
rownames(genes_df) <- NULL
# subset Seurat object to genes of interest
seurat_df <- P7F1@assays$RNA$data[genes_df$Values, ]
# define annotations -----------------------------------
# scale dataset
seurat_df <- seurat_df - rowMeans(seurat_df)
seurat_df <- as.data.frame(seurat_df)
# define annotations (important: order based on new order of cells)
metadata2 <- metadata[colnames(seurat_df), ]
metadata <- metadata2
annotation_info <- metadata[, c("Cluster_assignment")]
# define colors  -----------------------------------
# Color Louvain clusters
col_Cluster_assignment <-  c("#7FBC41FF", '#FFAD72FF', '#FFE5CCFF', "#8E0152FF",'#66C5CCFF')
names(col_Cluster_assignment) <- c('Progenitor', 'Proliferative', 'Ground', 'Differentiated', 'Neuronal')
col_column_ha <- list(Cluster_assignment = col_Cluster_assignment)
# define column annotation
column_ha = HeatmapAnnotation(df = annotation_info,
col = col_column_ha)
# define row annotation
row_ha = rowAnnotation(Group = genes_df$Group)
# genes to mark
rows_genes_to_mark <- which(genes_df$Values %in% elements_to_find)
rows_genes_to_mark_name <- genes_df$Values[rows_genes_to_mark]
right_ha = rowAnnotation(foo = anno_mark(at = rows_genes_to_mark,
labels = rows_genes_to_mark_name))
# define colors heatmap
col_fun = colorRamp2(c(-1, 0, 1), c("#2E5A87FF", "#FCFDFEFF", "#A90C38FF"))
# plot heatmap
Cairo::CairoPDF(file.path(plot_dir, "1_P7F1_heatmap_aggregate_50.pdf"), width=6, height=8)
ht <- Heatmap(seurat_df,
cluster_columns = FALSE,
show_row_names = FALSE,
show_column_names = FALSE,
#bottom_annotation = bottom_ha,
border = TRUE,
row_split = factor(c(genes_df$Group),
levels = c('Progenitor', 'Proliferative', 'Ground', 'Differentiated', 'Neuronal', 'Apoptosis')),
top_annotation = column_ha,
right_annotation = right_ha,
use_raster = TRUE,
raster_quality = 10,
cluster_rows = FALSE,
col = col_fun,
row_names_rot = 30
)
draw(ht)
dev.off()
# load Seurat object -----------------------------------
P7F1 <- readRDS(file.path(base_dir, "write/FPRMS_PAX7FOXO1_final_20240130.rds"))
# rename subtype
metadata <- P7F1@meta.data
colnames(P7F1@meta.data)
# save metadata as df
metadata <- data.frame(P7F1@meta.data)
# aggregate cells from same cluster -----------------------------------
P7F1 <- AggregateExpression(P7F1, return.seurat = TRUE)
# load gene lists -----------------------------------
markers <- read.csv(file.path(genelist_dir, 'P7F1_cluster_markers.csv'))
# rename DNA replication as Proliferative
markers <- markers %>%
mutate_all(~ ifelse(. == 'DNA replication', 'Proliferative', .))
# order by Annotation and fold change
markers <- markers %>% arrange(cluster, desc(avg_log2FC))
markers <- as.data.frame(markers)
# convert into list
marker_list <- split(markers[, -c(1:7)], f = markers$cluster)
# Remove duplicates and keep only one occurrence of each element
# Remove duplicates within each vector
marker_list <- lapply(marker_list, unique)
# select top 10 genes per cluster
marker_list <- lapply(marker_list,head,100)
# Subset seurat object to genes of interest -----------------------------------
# create df with genes of interest
genes <- marker_list
genes_df <- data.frame(
Values = unlist(marker_list),
Group = rep(names(marker_list), sapply(marker_list, length))
)
rownames(genes_df) <- NULL
# subset Seurat object to genes of interest
seurat_df <- P7F1@assays$RNA$data[genes_df$Values, ]
# define annotations -----------------------------------
# scale dataset
seurat_df <- seurat_df - rowMeans(seurat_df)
seurat_df <- as.data.frame(seurat_df)
# define annotations (important: order based on new order of cells)
metadata2 <- metadata[colnames(seurat_df), ]
metadata <- metadata2
annotation_info <- metadata[, c("Cluster_assignment")]
# define colors  -----------------------------------
# Color Louvain clusters
col_Cluster_assignment <-  c("#7FBC41FF", '#FFAD72FF', '#FFE5CCFF', "#8E0152FF",'#66C5CCFF')
names(col_Cluster_assignment) <- c('Progenitor', 'Proliferative', 'Ground', 'Differentiated', 'Neuronal')
col_column_ha <- list(Cluster_assignment = col_Cluster_assignment)
# define column annotation
column_ha = HeatmapAnnotation(df = annotation_info,
col = col_column_ha)
# define row annotation
row_ha = rowAnnotation(Group = genes_df$Group)
# genes to mark
rows_genes_to_mark <- which(genes_df$Values %in% elements_to_find)
rows_genes_to_mark_name <- genes_df$Values[rows_genes_to_mark]
right_ha = rowAnnotation(foo = anno_mark(at = rows_genes_to_mark,
labels = rows_genes_to_mark_name))
# define colors heatmap
col_fun = colorRamp2(c(-1, 0, 1), c("#2E5A87FF", "#FCFDFEFF", "#A90C38FF"))
# plot heatmap
Cairo::CairoPDF(file.path(plot_dir, "1_P7F1_heatmap_aggregate_50.pdf"), width=6, height=8)
ht <- Heatmap(seurat_df,
cluster_columns = FALSE,
show_row_names = FALSE,
show_column_names = FALSE,
#bottom_annotation = bottom_ha,
border = TRUE,
row_split = factor(c(genes_df$Group),
levels = c('Progenitor', 'Proliferative', 'Ground', 'Differentiated', 'Neuronal', 'Apoptosis')),
top_annotation = column_ha,
right_annotation = right_ha,
use_raster = TRUE,
raster_quality = 10,
cluster_rows = FALSE,
col = col_fun,
row_names_rot = 30
)
draw(ht)
dev.off()
colnames(P7F1@meta.data)
# load Seurat object -----------------------------------
P7F1 <- readRDS(file.path(base_dir, "write/FPRMS_PAX7FOXO1_final_20240130.rds"))
# rename subtype
metadata <- P7F1@meta.data
# save metadata as df
metadata <- data.frame(P7F1@meta.data)
# aggregate cells from same cluster -----------------------------------
P7F1 <- AggregateExpression(P7F1, return.seurat = TRUE)
# load Seurat object -----------------------------------
P7F1 <- readRDS(file.path(base_dir, "write/FPRMS_PAX7FOXO1_final_20240130.rds"))
head(P7F1@meta.data)
unique(P7F1@meta.data$`Cluster assignment`)
# aggregate cells from same cluster -----------------------------------
Idents(P7F1) <- `Cluster assignment`
# aggregate cells from same cluster -----------------------------------
Idents(P7F1) <- 'Cluster assignment'
P7F1 <- AggregateExpression(P7F1, return.seurat = TRUE)
# load gene lists -----------------------------------
markers <- read.csv(file.path(genelist_dir, 'P7F1_cluster_markers.csv'))
# rename DNA replication as Proliferative
markers <- markers %>%
mutate_all(~ ifelse(. == 'DNA replication', 'Proliferative', .))
# order by Annotation and fold change
markers <- markers %>% arrange(cluster, desc(avg_log2FC))
markers <- as.data.frame(markers)
# convert into list
marker_list <- split(markers[, -c(1:7)], f = markers$cluster)
# Remove duplicates and keep only one occurrence of each element
# Remove duplicates within each vector
marker_list <- lapply(marker_list, unique)
# select top 10 genes per cluster
marker_list <- lapply(marker_list,head,100)
# Subset seurat object to genes of interest -----------------------------------
# create df with genes of interest
genes <- marker_list
genes_df <- data.frame(
Values = unlist(marker_list),
Group = rep(names(marker_list), sapply(marker_list, length))
)
rownames(genes_df) <- NULL
# subset Seurat object to genes of interest
seurat_df <- P7F1@assays$RNA$data[genes_df$Values, ]
# define annotations -----------------------------------
# scale dataset
seurat_df <- seurat_df - rowMeans(seurat_df)
seurat_df <- as.data.frame(seurat_df)
# define annotations (important: order based on new order of cells)
metadata2 <- metadata[colnames(seurat_df), ]
metadata <- metadata2
annotation_info <- metadata[, c("Cluster_assignment")]
# define colors  -----------------------------------
# Color Louvain clusters
col_Cluster_assignment <-  c("#7FBC41FF", '#FFAD72FF', '#FFE5CCFF', "#8E0152FF",'#66C5CCFF')
names(col_Cluster_assignment) <- c('Progenitor', 'Proliferative', 'Ground', 'Differentiated', 'Neuronal')
col_column_ha <- list(Cluster_assignment = col_Cluster_assignment)
# define column annotation
column_ha = HeatmapAnnotation(df = annotation_info,
col = col_column_ha)
# define row annotation
row_ha = rowAnnotation(Group = genes_df$Group)
# genes to mark
rows_genes_to_mark <- which(genes_df$Values %in% elements_to_find)
rows_genes_to_mark_name <- genes_df$Values[rows_genes_to_mark]
right_ha = rowAnnotation(foo = anno_mark(at = rows_genes_to_mark,
labels = rows_genes_to_mark_name))
# define colors heatmap
col_fun = colorRamp2(c(-1, 0, 1), c("#2E5A87FF", "#FCFDFEFF", "#A90C38FF"))
# plot heatmap
Cairo::CairoPDF(file.path(plot_dir, "1_P7F1_heatmap_aggregate_50.pdf"), width=6, height=8)
ht <- Heatmap(seurat_df,
cluster_columns = FALSE,
show_row_names = FALSE,
show_column_names = FALSE,
#bottom_annotation = bottom_ha,
border = TRUE,
row_split = factor(c(genes_df$Group),
levels = c('Progenitor', 'Proliferative', 'Ground', 'Differentiated', 'Neuronal', 'Apoptosis')),
top_annotation = column_ha,
right_annotation = right_ha,
use_raster = TRUE,
raster_quality = 10,
cluster_rows = FALSE,
col = col_fun,
row_names_rot = 30
)
draw(ht)
dev.off()
# load Seurat object -----------------------------------
P7F1 <- readRDS(file.path(base_dir, "write/FPRMS_PAX7FOXO1_final_20240130.rds"))
# rename subtype
metadata <- P7F1@meta.data
head(metadata)
# aggregate cells from same cluster -----------------------------------
Idents(P7F1) <- 'Cluster assignment'
Idents(P7F1)
P7F1 <- AggregateExpression(P7F1, return.seurat = TRUE)
head(P7F1)
# load gene lists -----------------------------------
markers <- read.csv(file.path(genelist_dir, 'P7F1_cluster_markers.csv'))
# rename DNA replication as Proliferative
markers <- markers %>%
mutate_all(~ ifelse(. == 'DNA replication', 'Proliferative', .))
# order by Annotation and fold change
markers <- markers %>% arrange(cluster, desc(avg_log2FC))
markers <- as.data.frame(markers)
# convert into list
marker_list <- split(markers[, -c(1:7)], f = markers$cluster)
# Remove duplicates and keep only one occurrence of each element
# Remove duplicates within each vector
marker_list <- lapply(marker_list, unique)
# select top 10 genes per cluster
marker_list <- lapply(marker_list,head,100)
marker_list
# Subset seurat object to genes of interest -----------------------------------
# create df with genes of interest
genes <- marker_list
genes_df <- data.frame(
Values = unlist(marker_list),
Group = rep(names(marker_list), sapply(marker_list, length))
)
rownames(genes_df) <- NULL
rownames(genes_df)
genes_df
# subset Seurat object to genes of interest
seurat_df <- P7F1@assays$RNA$data[genes_df$Values, ]
# define annotations -----------------------------------
# scale dataset
seurat_df <- seurat_df - rowMeans(seurat_df)
seurat_df <- as.data.frame(seurat_df)
colnames(seurat_df)
# define annotations (important: order based on new order of cells)
metadata2 <- metadata[colnames(seurat_df), ]
metadata <- metadata2
annotation_info <- metadata[, c("Cluster_assignment")]
annotation_info
metadata
# define row annotation
row_ha = rowAnnotation(Group = genes_df$Group)
# genes to mark
rows_genes_to_mark <- which(genes_df$Values %in% elements_to_find)
rows_genes_to_mark_name <- genes_df$Values[rows_genes_to_mark]
right_ha = rowAnnotation(foo = anno_mark(at = rows_genes_to_mark,
labels = rows_genes_to_mark_name))
# define colors heatmap
col_fun = colorRamp2(c(-1, 0, 1), c("#2E5A87FF", "#FCFDFEFF", "#A90C38FF"))
# plot heatmap
Cairo::CairoPDF(file.path(plot_dir, "1_P7F1_heatmap_aggregate_50.pdf"), width=6, height=8)
ht <- Heatmap(seurat_df,
cluster_columns = FALSE,
show_row_names = FALSE,
show_column_names = FALSE,
#bottom_annotation = bottom_ha,
border = TRUE,
row_split = factor(c(genes_df$Group),
levels = c('Progenitor', 'Proliferative', 'Ground', 'Differentiated', 'Neuronal', 'Apoptosis')),
#top_annotation = column_ha,
right_annotation = right_ha,
use_raster = TRUE,
raster_quality = 10,
cluster_rows = FALSE,
col = col_fun,
row_names_rot = 30
)
draw(ht)
dev.off()
# plot heatmap
Cairo::CairoPDF(file.path(plot_dir, "1_P7F1_heatmap_aggregate_50.pdf"), width=5, height=6)
ht <- Heatmap(seurat_df,
cluster_columns = FALSE,
show_row_names = FALSE,
show_column_names = FALSE,
#bottom_annotation = bottom_ha,
border = TRUE,
row_split = factor(c(genes_df$Group),
levels = c('Progenitor', 'Proliferative', 'Ground', 'Differentiated', 'Neuronal', 'Apoptosis')),
#top_annotation = column_ha,
right_annotation = right_ha,
use_raster = TRUE,
raster_quality = 10,
cluster_rows = FALSE,
col = col_fun,
row_names_rot = 30
)
draw(ht)
dev.off()
# Load packages -----------------------------------
rm(list = ls())
library(dplyr)
library(Seurat)
library(ggplot2)
library(patchwork)
library(readxl)
library(data.table)
library(ComplexHeatmap)
library(magick)
library(RColorBrewer)
library(circlize)
library(ggpubr)
#library(openxlsx)
# Organize environment  -----------------------------------
base_dir <- '/Volumes/Sara_PhD/scRNAseq_data'
genelist_dir <- file.path(base_dir, 'list_final')
analysis_dir <- file.path(base_dir, 'output/metadata/Patel_Danielli_Langenau/RPCA_name/heatmap')
plot_dir <- file.path(analysis_dir, 'plot')
if (!dir.exists(plot_dir)){dir.create(plot_dir, recursive = T)}
write_dir <- file.path(analysis_dir, 'data')
if (!dir.exists(write_dir)){dir.create(write_dir, recursive = T)}
# -----------------------------------------------------------------------
# (2) Heatmap top marker genes FP-RMS (PAX3::FOXO1) clusters
# -----------------------------------------------------------------------
# load Seurat object -----------------------------------
P3F1 <- readRDS(file.path(base_dir, "write/Danielli_Patel_Langenau_RPCA_ARMS_P3F1_20230713.rds"))
# rename P3F1 (problem with current IDs)
Idents(P3F1) = "cluster_names"
new.cluster.ids.aggregate <- c('Progenitor', 'Proliferative', 'Proliferative', 'Ground', 'Differentiated', 'Neuronal', 'Apoptosis')
names(new.cluster.ids.aggregate) <- levels(P3F1)
P3F1<- RenameIdents(P3F1, new.cluster.ids.aggregate)
P3F1[["cluster_names_aggregate"]] <- Idents(object = P3F1)
levels(P3F1) <- c('Progenitor', 'Proliferative', 'Ground', 'Differentiated', 'Neuronal', 'Apoptosis')
# rename subtype
metadata <- P3F1@meta.data
# rename DS.Difference_common score into lineage score
colnames(P3F1@meta.data)[34] <- "Cluster_assignment"
# save metadata as df
metadata <- data.frame(P3F1@meta.data)
# aggregate cells from same cluster -----------------------------------
P3F1 <- AggregateExpression(P3F1, return.seurat = TRUE)
# load gene lists -----------------------------------
markers <- read.csv(file.path(genelist_dir, 'P3F1_cluster_markers.csv'))
# rename DNA replication as Proliferative
markers <- markers %>%
mutate_all(~ ifelse(. == 'DNA replication', 'Proliferative', .))
# order by Annotation and fold change
markers <- markers %>% arrange(cluster, desc(avg_log2FC))
markers <- as.data.frame(markers)
# convert into list
marker_list <- split(markers[, -c(1:7)], f = markers$cluster)
# select top 10 genes per cluster
marker_list <- lapply(marker_list,head,100)
# Subset seurat object to genes of interest -----------------------------------
# create df with genes of interest
genes <- marker_list
genes_df <- data.frame(
Values = unlist(marker_list),
Group = rep(names(marker_list), sapply(marker_list, length))
)
rownames(genes_df) <- NULL
# subset Seurat object to genes of interest
seurat_df <- P3F1@assays$RNA$data[genes_df$Values, ]
# define annotations -----------------------------------
# scale dataset
seurat_df <- seurat_df - rowMeans(seurat_df)
seurat_df <- as.data.frame(seurat_df)
# define row annotation
row_ha = rowAnnotation(Group = genes_df$Group)
# genes to mark
elements_to_find <- c('FN1', 'CAV1', 'PAX7', 'MEOX2', 'CD44',
'MYOD1', 'MYOG', 'MYH3',
'MKI67', 'CENPF',
'TTN', 'MYL4',
'SYP', 'L1CAM', 'CHGA', 'DCX', 'STMN4')
rows_genes_to_mark <- which(genes_df$Values %in% elements_to_find)
rows_genes_to_mark_name <- genes_df$Values[rows_genes_to_mark]
right_ha = rowAnnotation(foo = anno_mark(at = rows_genes_to_mark,
labels = rows_genes_to_mark_name))
# define colors heatmap
col_fun = colorRamp2(c(-1, 0, 1), c("#2E5A87FF", "#FCFDFEFF", "#A90C38FF"))
# plot heatmap
Cairo::CairoPDF(file.path(plot_dir, "1_P3F1_heatmap_aggregate_50.pdf"), width=5, height=6)
ht <- Heatmap(seurat_df,
cluster_columns = FALSE,
show_row_names = FALSE,
show_column_names = FALSE,
#bottom_annotation = bottom_ha,
border = TRUE,
row_split = factor(c(genes_df$Group),
levels = c('Progenitor', 'Proliferative', 'Ground', 'Differentiated', 'Neuronal', 'Apoptosis')),
#top_annotation = column_ha,
right_annotation = right_ha,
use_raster = TRUE,
raster_quality = 10,
cluster_rows = FALSE,
col = col_fun
)
draw(ht)
dev.off()
